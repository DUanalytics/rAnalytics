# Decision Tree - Classification
#we want predict for combination of input variables, is a person likely to survive or not
library(dplyr)
#import data from online site
path = 'https://raw.githubusercontent.com/DUanalytics/datasets/master/csv/titanic_train.csv'
titanic <- read.csv(path)
head(titanic)
names(titanic)
data = titanic[,c(2,3,5,6,7)]  #select few columns only
head(data)
dim(data)
#load libraries
library(rpart)
library(rpart.plot)
str(data)
#Decision Tree
names(data)
table(data$Survived)
342/891
str(data)
data$Pclass = factor(data$Pclass)
str(data)
table(data$Sex)
table(data$Pclass)
table(data$Pclass, data$Survived)
head(data)
fit <- rpart(Survived ~ ., data = data, method = 'class')
#fit1 <- rpart(Survived ~ Pclass + Sex + Age + Sibsp, data=data, method='class')
fit
rpart.plot(fit)
rpart.plot(fit, extra = 104, cex=.6, nn=T)  #plot
nrow(data)
table(data$Survived)
342/891; 549/891
table(data$Sex)
head(data)
printcp(fit) #select complexity parameter
prunetree2 = prune(fit, cp=.018)
rpart.plot(prunetree2, cex=.8,nn=T, extra=104)
prunetree2
nrow(data)
table(data$Survived)
# predict for Female, pclass=3, siblings=2, what is the chance of survival

#Predict class category or probabilities
(testdata = sample_n(data,2))
predict(prunetree2, newdata=testdata, type='class')
predict(prunetree2, newdata=testdata, type='prob')
str(data)
testdata2 = data.frame(Pclass=factor(2), Sex=factor('male'), Age=15, SibSp=2)
testdata2
predict(prunetree2, newdata = testdata2, type='class')
predict(prunetree2, newdata = testdata2, type='prob')

#Use decision trees for predicting
#customer is likely to buy a product or not with probabilities
#customer is likely to default on payment or not with probabilities
#Student is likely to get selected, cricket team likely to win etc

#Imp steps
#select columns for prediction
#load libraries, create model y ~ x1 + x2 
#prune the tree with cp value
#plot the graph
#predict for new cases

#rpart, CART, classification model
#regression decision = predict numerical value eg sales

